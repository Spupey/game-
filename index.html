<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Coal Mine Clicker ‚Äî –ü–æ–ª–Ω—ã–π —à–∞—Ö—Ç–µ—Ä—Å–∫–∏–π —Å–∏–º—É–ª—è—Ç–æ—Ä</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap');
  * {
    box-sizing: border-box;
  }
  body, html {
    margin:0; padding:0;
    width:100%; height:100%;
    background: linear-gradient(135deg, #222 0%, #111 100%);
    font-family: 'Montserrat', sans-serif;
    color: #eee;
    overflow: hidden;
    user-select: none;
  }
  #gameCanvas {
    display: block;
    background: radial-gradient(circle at center, #222 0%, #000 90%);
    margin: 0 auto;
    box-shadow: 0 0 15px #000 inset;
  }
  #ui {
    position: absolute;
    top: 10px; left: 10px;
    background: rgba(20,20,20,0.85);
    border-radius: 12px;
    padding: 15px 20px;
    width: 320px;
    box-shadow: 0 0 20px #0f0f0f;
  }
  #ui h1 {
    margin: 0 0 10px 0;
    font-weight: 700;
    text-align: center;
    color: #ffd54f;
    text-shadow: 0 0 8px #ffb300;
  }
  .resource-row {
    display: flex;
    align-items: center;
    margin-bottom: 8px;
    font-size: 16px;
  }
  .resource-row img {
    width: 24px;
    height: 24px;
    margin-right: 8px;
  }
  #resources {
    margin-bottom: 15px;
  }
  button {
    background: linear-gradient(135deg, #555, #222);
    border: none;
    border-radius: 8px;
    padding: 10px 15px;
    margin: 5px 0;
    color: #ffd54f;
    font-weight: 700;
    cursor: pointer;
    transition: background 0.3s ease;
    box-shadow: 0 0 5px #ffa000;
  }
  button:hover:not(:disabled) {
    background: linear-gradient(135deg, #ffca28, #ffa000);
    color: #222;
    box-shadow: 0 0 12px #ffc107;
    transform: scale(1.05);
  }
  button:disabled {
    opacity: 0.3;
    cursor: default;
  }
  #shop, #achievements, #tutorial {
    background: rgba(10,10,10,0.95);
    position: absolute;
    top: 60px; left: 350px;
    width: 400px;
    max-height: 80vh;
    overflow-y: auto;
    border-radius: 14px;
    padding: 15px;
    box-shadow: 0 0 20px #ffb300;
    display: none;
  }
  #shop.active, #achievements.active, #tutorial.active {
    display: block;
  }
  #shop h2, #achievements h2, #tutorial h2 {
    text-align: center;
    margin-bottom: 15px;
    color: #ffca28;
    text-shadow: 0 0 8px #ffb300;
  }
  .shop-item, .achievement-item {
    background: #222;
    border-radius: 10px;
    margin-bottom: 12px;
    padding: 10px 15px;
    cursor: pointer;
    display: flex;
    align-items: center;
    transition: background 0.3s ease;
    box-shadow: 0 0 5px #444 inset;
  }
  .shop-item:hover:not(.disabled), .achievement-item:hover {
    background: #444;
    box-shadow: 0 0 10px #ffca28 inset;
  }
  .shop-item.disabled {
    opacity: 0.4;
    cursor: default;
  }
  .shop-item img, .achievement-item img {
    width: 36px;
    height: 36px;
    margin-right: 15px;
    filter: drop-shadow(0 0 3px #ffb300);
  }
  .shop-details {
    flex-grow: 1;
  }
  .shop-details strong {
    font-size: 18px;
    color: #ffd54f;
  }
  .shop-cost {
    font-weight: 700;
    color: #ffb300;
    min-width: 80px;
    text-align: right;
  }
  #buttonsRow {
    margin-top: 10px;
    display: flex;
    justify-content: space-between;
  }
  #buttonsRow button {
    width: 48%;
  }
  #musicControl {
    position: absolute;
    top: 10px; right: 10px;
    background: rgba(30,30,30,0.9);
    border-radius: 12px;
    padding: 10px 15px;
    box-shadow: 0 0 15px #ffb300;
    cursor: pointer;
    user-select: none;
    font-weight: 700;
    color: #ffd54f;
    transition: background 0.3s ease;
  }
  #musicControl:hover {
    background: #ffca28;
    color: #222;
    box-shadow: 0 0 20px #ffc107;
  }
  /* Scrollbar styling for shop and achievements */
  #shop::-webkit-scrollbar, #achievements::-webkit-scrollbar, #tutorial::-webkit-scrollbar {
    width: 8px;
  }
  #shop::-webkit-scrollbar-track, #achievements::-webkit-scrollbar-track, #tutorial::-webkit-scrollbar-track {
    background: #111;
    border-radius: 10px;
  }
  #shop::-webkit-scrollbar-thumb, #achievements::-webkit-scrollbar-thumb, #tutorial::-webkit-scrollbar-thumb {
    background: #ffb300;
    border-radius: 10px;
  }
  /* Tooltip */
  .tooltip {
    position: relative;
  }
  .tooltip:hover::after {
    content: attr(data-tooltip);
    position: absolute;
    bottom: 125%;
    left: 50%;
    transform: translateX(-50%);
    background: #333;
    padding: 6px 10px;
    border-radius: 6px;
    white-space: nowrap;
    font-size: 13px;
    box-shadow: 0 0 8px #222;
    color: #fff;
    opacity: 0.95;
    pointer-events: none;
    z-index: 10;
  }
</style>
</head>
<body>

<canvas id="gameCanvas" width="900" height="600"></canvas>

<div id="ui">
  <h1>Coal Mine Clicker</h1>
  <div id="resources">
    <div class="resource-row"><img src="https://cdn-icons-png.flaticon.com/512/3208/3208721.png" alt="Coal"> –£–≥–æ–ª—å: <span id="coalCount">0</span></div>
    <div class="resource-row"><img src="https://cdn-icons-png.flaticon.com/512/854/854878.png" alt="Pickaxe"> –ö–∏—Ä–∫–∞: <span id="pickaxeLevel">1</span></div>
    <div class="resource-row">–£—Ä–æ–≤–µ–Ω—å: <span id="playerLevel">1</span> | –û–ø—ã—Ç: <span id="xpCount">0</span></div>
  </div>
  <button id="mineBtn">‚õè –î–æ–±—ã—Ç—å —É–≥–æ–ª—å</button>
  <button id="upgradePickaxeBtn" class="tooltip" data-tooltip="–£–ª—É—á—à–µ–Ω–∏–µ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —É—Ä–æ–Ω –∏ —Å–∫–æ—Ä–æ—Å—Ç—å –¥–æ–±—ã—á–∏.">üî® –£–ª—É—á—à–∏—Ç—å –∫–∏—Ä–∫—É (10 —É–≥–ª—è)</button>

  <div id="buttonsRow">
    <button id="openShopBtn">üõí –ú–∞–≥–∞–∑–∏–Ω</button>
    <button id="openAchievementsBtn">üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</button>
  </div>
  <button id="openTutorialBtn" style="margin-top:10px;">üìò –ü–æ–º–æ—â—å</button>
</div>

<div id="shop">
  <h2>–ú–∞–≥–∞–∑–∏–Ω</h2>
  <div id="shopItems"></div>
</div>

<div id="achievements">
  <h2>–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h2>
  <div id="achievementItems"></div>
</div>

<div id="tutorial">
  <h2>–ö–∞–∫ –∏–≥—Ä–∞—Ç—å</h2>
  <p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Coal Mine Clicker! –ó–¥–µ—Å—å —Ç—ã –¥–æ–±—ã–≤–∞–µ—à—å —É–≥–æ–ª—å –∫–ª–∏–∫–∞–º–∏ –ø–æ –ø–æ—Ä–æ–¥–µ, –ø—Ä–æ–∫–∞—á–∏–≤–∞–µ—à—å –∫–∏—Ä–∫—É, –æ—Ç–∫—Ä—ã–≤–∞–µ—à—å –Ω–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∏ –±—å–µ—à—å –±–æ—Å—Å–æ–≤.</p>
  <ul>
    <li>–ù–∞–∂–∏–º–∞–π –Ω–∞ –∫–Ω–æ–ø–∫—É "–î–æ–±—ã—Ç—å —É–≥–æ–ª—å" –∏–ª–∏ –∫–ª–∏–∫–∞–π –ø–æ –∫–∞–º–Ω—é, —á—Ç–æ–±—ã –¥–æ–±—ã–≤–∞—Ç—å —Ä–µ—Å—É—Ä—Å—ã.</li>
    <li>–£–ª—É—á—à–∏ –∫–∏—Ä–∫—É, —á—Ç–æ–±—ã –¥–æ–±—ã–≤–∞—Ç—å –±–æ–ª—å—à–µ –∑–∞ –∫–ª–∏–∫.</li>
    <li>–ó–∞–π–¥–∏ –≤ –º–∞–≥–∞–∑–∏–Ω, —á—Ç–æ–±—ã –Ω–∞–Ω–∏–º–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —à–∞—Ö—Ç–µ—Ä–æ–≤ –∏ –ø–æ–∫—É–ø–∞—Ç—å –±–æ–Ω—É—Å—ã.</li>
    <li>–ó–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π –æ–ø—ã—Ç, —á—Ç–æ–±—ã –ø–æ–≤—ã—à–∞—Ç—å —É—Ä–æ–≤–µ–Ω—å –∏ –ø–æ–ª—É—á–∞—Ç—å –Ω–æ–≤—ã–µ –Ω–∞–≥—Ä–∞–¥—ã.</li>
    <li>–°–ª–µ–¥–∏ –∑–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è–º–∏ –∏ –æ—Ç–∫—Ä—ã–≤–∞–π —Å–µ–∫—Ä–µ—Ç—ã.</li>
  </ul>
  <button id="closeTutorialBtn" style="margin-top: 10px; width: 100%;">–ó–∞–∫—Ä—ã—Ç—å</button>
</div>

<div id="musicControl" title="–í–∫–ª—é—á–∏—Ç—å/–í—ã–∫–ª—é—á–∏—Ç—å –º—É–∑—ã–∫—É">üéµ –í–∫–ª</div>

<script>
(() => {
  // -- –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ --
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');

  // UI —ç–ª–µ–º–µ–Ω—Ç—ã
  const coalCountEl = document.getElementById('coalCount');
  const pickaxeLevelEl = document.getElementById('pickaxeLevel');
  const playerLevelEl = document.getElementById('playerLevel');
  const xpCountEl = document.getElementById('xpCount');

  const mineBtn = document.getElementById('mineBtn');
  const upgradePickaxeBtn = document.getElementById('upgradePickaxeBtn');

  const openShopBtn = document.getElementById('openShopBtn');
  const openAchievementsBtn = document.getElementById('openAchievementsBtn');
  const openTutorialBtn = document.getElementById('openTutorialBtn');
  const closeTutorialBtn = document.getElementById('closeTutorialBtn');

  const shop = document.getElementById('shop');
  const shopItemsContainer = document.getElementById('shopItems');
  const achievements = document.getElementById('achievements');
  const achievementItemsContainer = document.getElementById('achievementItems');
  const tutorial = document.getElementById('tutorial');

  const musicControl = document.getElementById('musicControl');

  // –ó–≤—É–∫–∏ (—Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º –≥—Ä–æ–º–∫–æ—Å—Ç–Ω—ã–º —É—Ä–æ–≤–Ω–µ–º –¥–ª—è —Ñ–æ–Ω–∞ –∏ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤)
  const soundMine = new Audio('https://freesound.org/data/previews/66/66717_931655-lq.mp3');
  const soundUpgrade = new Audio('https://freesound.org/data/previews/46/46436_634166-lq.mp3');
  const soundBuy = new Audio('https://freesound.org/data/previews/61/61754_634166-lq.mp3');
  const soundLevelUp = new Audio('https://freesound.org/data/previews/331/331912_3248244-lq.mp3');

  [soundMine, soundUpgrade, soundBuy, soundLevelUp].forEach(snd => {
    snd.volume = 0.15;
  });

  // –ú—É–∑—ã–∫–∞
  const bgMusic = new Audio('https://cdn.pixabay.com/download/audio/2022/04/29/audio_6613309b41.mp3?filename=relaxing-background-music-10712.mp3');
  bgMusic.loop = true;
  bgMusic.volume = 0.07;
  let musicPlaying = true;
  bgMusic.play();

  musicControl.onclick = () => {
    musicPlaying = !musicPlaying;
    if(musicPlaying){
      bgMusic.play();
      musicControl.textContent = 'üéµ –í–∫–ª';
    } else {
      bgMusic.pause();
      musicControl.textContent = 'üîá –í—ã–∫–ª';
    }
  };

  // –ò–≥—Ä–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
  let gameState = {
    coal: 0,
    pickaxeLevel: 1,
    xp: 0,
    playerLevel: 1,
    autoMiners: 0,
    autoMineInterval: null,
    clickPower: 1,
    upgrades: {
      pickaxeDamage: 1,
      pickaxeSpeed: 1,
    },
    achievementsUnlocked: new Set(),
  };

  // –ö–∏—Ä–∫–∏ - –æ–±—ä–µ–∫—Ç—ã —Å —Ä–∞–∑–Ω—ã–º–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º–∏
  const pickaxes = [
    {name: '–î–µ—Ä–µ–≤—è–Ω–Ω–∞—è –∫–∏—Ä–∫–∞', damage: 1, speed: 1, cost: 0, icon: 'https://cdn-icons-png.flaticon.com/512/854/854878.png'},
    {name: '–ö–∞–º–µ–Ω–Ω–∞—è –∫–∏—Ä–∫–∞', damage: 3, speed: 1.2, cost: 50, icon: 'https://cdn-icons-png.flaticon.com/512/854/854899.png'},
    {name: '–ñ–µ–ª–µ–∑–Ω–∞—è –∫–∏—Ä–∫–∞', damage: 7, speed: 1.6, cost: 150, icon: 'https://cdn-icons-png.flaticon.com/512/854/854873.png'},
    {name: '–ó–æ–ª–æ—Ç–∞—è –∫–∏—Ä–∫–∞', damage: 15, speed: 2.2, cost: 400, icon: 'https://cdn-icons-png.flaticon.com/512/854/854888.png'},
    {name: '–ê–ª–º–∞–∑–Ω–∞—è –∫–∏—Ä–∫–∞', damage: 40, speed: 3.5, cost: 1200, icon: 'https://cdn-icons-png.flaticon.com/512/854/854882.png'},
    {name: '–ù–µ–∑–µ—Ä–∏—Ç–æ–≤–∞—è –∫–∏—Ä–∫–∞', damage: 100, speed: 5, cost: 3500, icon: 'https://cdn-icons-png.flaticon.com/512/854/854889.png'}
  ];

  // –ú–∞–≥–∞–∑–∏–Ω–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —à–∞—Ö—Ç–µ—Ä—ã, –±–æ–Ω—É—Å—ã
  const shopItems = [
    {id: 'autoMiner', name: '–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —à–∞—Ö—Ç–µ—Ä', description: '–î–æ–±—ã–≤–∞–µ—Ç —É–≥–æ–ª—å –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã.', cost: 100, effect: () => {
      gameState.autoMiners++;
      if(!gameState.autoMineInterval) startAutoMining();
    }, icon: 'https://cdn-icons-png.flaticon.com/512/2040/2040979.png'},
    {id: 'doubleXP', name: '–£–¥–≤–æ–µ–Ω–Ω—ã–π –æ–ø—ã—Ç (30 —Å–µ–∫)', description: '–£–¥–≤–∞–∏–≤–∞–µ—Ç –ø–æ–ª—É—á–∞–µ–º—ã–π –æ–ø—ã—Ç –Ω–∞ 30 —Å–µ–∫—É–Ω–¥.', cost: 200, effect: () => {
      applyTemporaryEffect('doubleXP', 30000);
    }, icon: 'https://cdn-icons-png.flaticon.com/512/1057/1057249.png'},
    {id: 'coalMagnet', name: '–ú–∞–≥–Ω–∏—Ç –¥–ª—è —É–≥–ª—è (30 —Å–µ–∫)', description: '–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–±—ã–≤–∞–µ–º–æ–≥–æ —É–≥–ª—è –≤ 1.5 —Ä–∞–∑–∞.', cost: 250, effect: () => {
      applyTemporaryEffect('coalMagnet', 30000);
    }, icon: 'https://cdn-icons-png.flaticon.com/512/109/109579.png'}
  ];

  // –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è
  const achievementsData = [
    {id: 'firstMine', name: '–ü–µ—Ä–≤—ã–π —É–≥–æ–ª—å', description: '–î–æ–±—ã—Ç—å –ø–µ—Ä–≤—ã–π —É–≥–æ–ª—å.', unlocked: false},
    {id: 'level5', name: '–£—Ä–æ–≤–µ–Ω—å 5', description: '–î–æ—Å—Ç–∏—á—å 5 —É—Ä–æ–≤–Ω—è.', unlocked: false},
    {id: 'pickaxe5', name: '–ö–∏—Ä–∫–∞ 5 —É—Ä–æ–≤–Ω—è', description: '–î–æ—Å—Ç–∏—á—å 5 —É—Ä–æ–≤–Ω—è –∫–∏—Ä–∫–∏.', unlocked: false},
    {id: 'autoMiner10', name: '10 –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —à–∞—Ö—Ç–µ—Ä–æ–≤', description: '–ù–∞–Ω—è—Ç—å 10 –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —à–∞—Ö—Ç–µ—Ä–æ–≤.', unlocked: false},
    {id: 'coal1000', name: '1000 —É–≥–ª—è', description: '–ù–∞–∫–æ–ø–∏—Ç—å 1000 —É–≥–ª—è.', unlocked: false}
  ];

  // –≠—Ñ—Ñ–µ–∫—Ç—ã
  let activeEffects = {};

  function applyTemporaryEffect(effectName, duration) {
    activeEffects[effectName] = true;
    setTimeout(() => {
      delete activeEffects[effectName];
      renderShop();
    }, duration);
    renderShop();
  }

  // –í—Å–ø–ª—ã–≤–∞—é—â–∏–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –Ω–∞ –∫–∞–Ω–≤–∞—Å–µ
  let particles = [];

  class Particle {
    constructor(x, y, color) {
      this.x = x;
      this.y = y;
      this.radius = 5 + Math.random() * 3;
      this.color = color;
      this.alpha = 1;
      this.speedX = (Math.random() - 0.5) * 2;
      this.speedY = (Math.random() - 1.5) * 2;
      this.gravity = 0.03;
    }
    update() {
      this.speedY += this.gravity;
      this.x += this.speedX;
      this.y += this.speedY;
      this.alpha -= 0.02;
    }
    draw(ctx) {
      ctx.save();
      ctx.globalAlpha = this.alpha;
      ctx.fillStyle = this.color;
      ctx.beginPath();
      ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
      ctx.fill();
      ctx.restore();
    }
    isAlive() {
      return this.alpha > 0;
    }
  }

  function spawnParticles(x, y, amount=12, color='#FFD54F'){
    for(let i=0; i < amount; i++){
      particles.push(new Particle(x, y, color));
    }
  }

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
  function updateUI() {
    coalCountEl.textContent = Math.floor(gameState.coal);
    pickaxeLevelEl.textContent = gameState.pickaxeLevel;
    playerLevelEl.textContent = gameState.playerLevel;
    xpCountEl.textContent = Math.floor(gameState.xp);
    upgradePickaxeBtn.disabled = gameState.coal < getPickaxeUpgradeCost();
  }

  // –°—Ç–æ–∏–º–æ—Å—Ç—å —É–ª—É—á—à–µ–Ω–∏—è –∫–∏—Ä–∫–∏
  function getPickaxeUpgradeCost(){
    if(gameState.pickaxeLevel >= pickaxes.length) return Infinity;
    return pickaxes[gameState.pickaxeLevel].cost;
  }

  // –£–ª—É—á—à–µ–Ω–∏–µ –∫–∏—Ä–∫–∏
  function upgradePickaxe(){
    const cost = getPickaxeUpgradeCost();
    if(gameState.coal >= cost){
      gameState.coal -= cost;
      gameState.pickaxeLevel++;
      soundUpgrade.play();
      spawnParticles(canvas.width/2, canvas.height/2, 30, '#ffbf00');
      checkAchievements();
      updateUI();
      renderShop();
    }
  }

  // –ö–ª–∏–∫ –ø–æ –¥–æ–±—ã—á–µ —É–≥–ª—è
  function mineCoal(){
    const baseDamage = pickaxes[gameState.pickaxeLevel-1].damage;
    let amount = baseDamage;
    if(activeEffects.coalMagnet) amount *= 1.5;
    gameState.coal += amount;
    gameState.xp += activeEffects.doubleXP ? 2 : 1;
    soundMine.currentTime = 0;
    soundMine.play();
    spawnParticles(canvas.width/2, canvas.height/2, 15, '#f5e663');
    checkLevelUp();
    checkAchievements();
    updateUI();
  }

  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–æ–±—ã—á–∞
  function startAutoMining(){
    if(gameState.autoMineInterval) clearInterval(gameState.autoMineInterval);
    gameState.autoMineInterval = setInterval(() => {
      if(gameState.autoMiners > 0){
        let amount = gameState.autoMiners * (pickaxes[gameState.pickaxeLevel-1].damage / 2);
        if(activeEffects.coalMagnet) amount *= 1.5;
        gameState.coal += amount;
        gameState.xp += activeEffects.doubleXP ? gameState.autoMiners * 2 : gameState.autoMiners;
        updateUI();
        checkLevelUp();
        checkAchievements();
        spawnParticles(canvas.width/2, canvas.height/2, 10, '#bbbbbb');
      }
    }, 2000 / pickaxes[gameState.pickaxeLevel-1].speed);
  }

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤—ã—à–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è
  function checkLevelUp(){
    const neededXP = gameState.playerLevel * 50;
    if(gameState.xp >= neededXP){
      gameState.playerLevel++;
      gameState.xp -= neededXP;
      soundLevelUp.play();
      spawnParticles(canvas.width/2, canvas.height/2, 40, '#4caf50');
      updateUI();
      checkAchievements();
    }
  }

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
  function checkAchievements(){
    if(!gameState.achievementsUnlocked.has('firstMine') && gameState.coal >= 1){
      unlockAchievement('firstMine');
    }
    if(!gameState.achievementsUnlocked.has('level5') && gameState.playerLevel >= 5){
      unlockAchievement('level5');
    }
    if(!gameState.achievementsUnlocked.has('pickaxe5') && gameState.pickaxeLevel >= 5){
      unlockAchievement('pickaxe5');
    }
    if(!gameState.achievementsUnlocked.has('autoMiner10') && gameState.autoMiners >= 10){
      unlockAchievement('autoMiner10');
    }
    if(!gameState.achievementsUnlocked.has('coal1000') && gameState.coal >= 1000){
      unlockAchievement('coal1000');
    }
  }

  function unlockAchievement(id){
    gameState.achievementsUnlocked.add(id);
    soundBuy.play();
    renderAchievements();
    alert(`–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ: ${achievementsData.find(a => a.id === id).name}`);
  }

  // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –º–∞–≥–∞–∑–∏–Ω–∞
  function renderShop(){
    shopItemsContainer.innerHTML = '';
    shopItems.forEach(item => {
      const div = document.createElement('div');
      div.classList.add('shop-item');
      if(gameState.coal < item.cost) div.classList.add('disabled');

      if(activeEffects[item.id]) {
        div.style.background = 'linear-gradient(135deg, #ffa726, #fb8c00)';
        div.style.color = '#222';
        div.style.cursor = 'default';
      }

      div.innerHTML = `
        <img src="${item.icon}" alt="${item.name}">
        <div class="shop-details">
          <strong>${item.name}</strong><br>
          <small>${item.description}</small>
        </div>
        <div class="shop-cost">${activeEffects[item.id] ? '–ê–∫—Ç–∏–≤–Ω–æ' : item.cost + ' —É–≥–ª—è'}</div>
      `;
      if(!activeEffects[item.id]){
        div.onclick = () => {
          if(gameState.coal >= item.cost){
            gameState.coal -= item.cost;
            item.effect();
            soundBuy.play();
            updateUI();
            renderShop();
            checkAchievements();
          }
        };
      }
      shopItemsContainer.appendChild(div);
    });
  }

  // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
  function renderAchievements(){
    achievementItemsContainer.innerHTML = '';
    achievementsData.forEach(a => {
      const div = document.createElement('div');
      div.className = 'achievement-item';
      if(gameState.achievementsUnlocked.has(a.id)){
        div.style.background = 'linear-gradient(135deg, #66bb6a, #43a047)';
      } else {
        div.style.opacity = 0.5;
      }
      div.innerHTML = `
        <img src="https://cdn-icons-png.flaticon.com/512/616/616408.png" alt="Achievement">
        <div>
          <strong>${a.name}</strong><br>
          <small>${a.description}</small>
        </div>
      `;
      achievementItemsContainer.appendChild(div);
    });
  }

  // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ç—É—Ç–æ—Ä–∏–∞–ª–∞ (–¥–µ–ª–∞–µ–º –≤–∏–¥–∏–º—ã–º/—Å–∫—Ä—ã–≤–∞–µ–º)
  openTutorialBtn.onclick = () => {
    tutorial.classList.add('active');
  };
  closeTutorialBtn.onclick = () => {
    tutorial.classList.remove('active');
  };

  // –ö–Ω–æ–ø–∫–∏ UI
  mineBtn.onclick = () => {
    mineCoal();
    animateHit();
  };
  upgradePickaxeBtn.onclick = () => upgradePickaxe();
  openShopBtn.onclick = () => {
    shop.classList.toggle('active');
    achievements.classList.remove('active');
    tutorial.classList.remove('active');
  };
  openAchievementsBtn.onclick = () => {
    achievements.classList.toggle('active');
    shop.classList.remove('active');
    tutorial.classList.remove('active');
  };

  // –ê–Ω–∏–º–∞—Ü–∏—è –¥–æ–±—ã—á–∏ (–Ω–∞ –∫–∞–º–Ω–µ)
  let hitAnimationFrame = 0;
  let hitAnimating = false;
  function animateHit(){
    hitAnimating = true;
    hitAnimationFrame = 0;
  }

  // –û—Å–Ω–æ–≤–Ω–æ–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥
  function draw() {
    // –û—á–∏—Å—Ç–∫–∞
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // –§–æ–Ω —à–∞—Ö—Ç—ã (–≥–ª—ã–±–∞ —É–≥–ª—è)
    let grad = ctx.createRadialGradient(canvas.width/2, canvas.height/2, 10, canvas.width/2, canvas.height/2, 300);
    grad.addColorStop(0, '#3a3a3a');
    grad.addColorStop(1, '#000000');
    ctx.fillStyle = grad;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // –†–∏—Å—É–µ–º –∫–∞–º–µ–Ω—å (–±–æ–ª—å—à–æ–π –∫—Ä—É–≥)
    const stoneX = canvas.width/2;
    const stoneY = canvas.height/2;
    const stoneRadius = 150;

    ctx.save();
    if(hitAnimating){
      // –í–∏–±—Ä–∞—Ü–∏—è –ø—Ä–∏ —É–¥–∞—Ä–µ
      const shakeAmount = 3;
      const shakeX = (Math.random() - 0.5) * shakeAmount;
      const shakeY = (Math.random() - 0.5) * shakeAmount;
      ctx.translate(shakeX, shakeY);
    }
    // –ö–∞–º–µ–Ω—å
    const stoneGrad = ctx.createRadialGradient(stoneX, stoneY, 10, stoneX, stoneY, stoneRadius);
    stoneGrad.addColorStop(0, '#555555');
    stoneGrad.addColorStop(1, '#222222');
    ctx.fillStyle = stoneGrad;
    ctx.beginPath();
    ctx.arc(stoneX, stoneY, stoneRadius, 0, Math.PI * 2);
    ctx.fill();

    // –¢—Ä–µ—â–∏–Ω—ã –Ω–∞ –∫–∞–º–Ω–µ (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø–æ —É—Ä–æ–≤–Ω—é –∫–∏—Ä–∫–∏)
    ctx.strokeStyle = '#888';
    ctx.lineWidth = 2;
    ctx.beginPath();
    for(let i = 0; i < gameState.pickaxeLevel + 2; i++){
      const angle = (i / (gameState.pickaxeLevel + 2)) * Math.PI * 2 + (performance.now() * 0.001);
      const innerRadius = stoneRadius * 0.3;
      const outerRadius = stoneRadius * (0.7 + 0.1 * Math.sin(performance.now() * 0.005 + i));
      ctx.moveTo(stoneX + Math.cos(angle) * innerRadius, stoneY + Math.sin(angle) * innerRadius);
      ctx.lineTo(stoneX + Math.cos(angle) * outerRadius, stoneY + Math.sin(angle) * outerRadius);
    }
    ctx.stroke();

    ctx.restore();

    // –ß–∞—Å—Ç–∏—Ü—ã
    particles = particles.filter(p => p.isAlive());
    particles.forEach(p => {
      p.update();
      p.draw(ctx);
    });

    // –ê–Ω–∏–º–∞—Ü–∏—è —É–¥–∞—Ä–∞ –∫–∞–º–Ω—è
    if(hitAnimating){
      hitAnimationFrame++;
      if(hitAnimationFrame > 10){
        hitAnimating = false;
      }
    }

    requestAnimationFrame(draw);
  }

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
  updateUI();
  renderShop();
  renderAchievements();
  draw();
})();
</script>

</body>
</html>

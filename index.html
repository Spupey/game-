<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Coal Mine Clicker - –£–ª—É—á—à–µ–Ω–Ω—ã–π</title>
<style>
  /* --- –û–±—â–∏–µ —Å—Ç–∏–ª–∏ --- */
  @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@600&display=swap');

  body, html {
    margin: 0; padding: 0; overflow: hidden;
    height: 100vh;
    background: radial-gradient(circle at center, #0d1117 0%, #161b22 100%);
    font-family: 'Montserrat', sans-serif;
    color: #c9d1d9;
    user-select: none;
  }

  #gameCanvas {
    display: block;
    background: linear-gradient(180deg, #22272e 0%, #0d1117 100%);
  }

  /* --- UI –ë–ª–æ–∫ --- */
  #ui {
    position: absolute;
    top: 10px; left: 10px;
    width: 300px;
    background: rgba(12, 17, 23, 0.85);
    border-radius: 14px;
    box-shadow: 0 0 20px #0af, inset 0 0 30px #0af;
    padding: 20px;
    z-index: 100;
  }

  #ui h1 {
    font-weight: 700;
    font-size: 24px;
    margin: 0 0 15px 0;
    text-align: center;
    color: #4ade80; /* —è—Ä–∫–æ-–∑–µ–ª–µ–Ω—ã–π */
    text-shadow: 0 0 8px #4ade80;
  }

  #resources {
    margin-bottom: 20px;
  }

  .res-line {
    display: flex;
    align-items: center;
    margin-bottom: 10px;
    font-size: 16px;
  }

  .res-line img {
    width: 24px; height: 24px;
    margin-right: 10px;
    filter: drop-shadow(0 0 2px #0af);
  }

  .res-value {
    flex-grow: 1;
    text-align: right;
    font-weight: 600;
    color: #a5b4fc;
  }

  /* --- –ö–Ω–æ–ø–∫–∏ --- */
  button {
    width: 100%;
    margin-top: 10px;
    padding: 12px;
    font-weight: 700;
    font-size: 16px;
    border-radius: 10px;
    border: none;
    cursor: pointer;
    background: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%);
    color: #e0e7ff;
    box-shadow: 0 4px 10px #3b82f6aa;
    transition: all 0.25s ease;
    text-shadow: 0 0 5px #dbeafe;
  }
  button:hover {
    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
    box-shadow: 0 6px 14px #60a5faee;
    transform: scale(1.05);
  }
  button:active {
    transform: scale(0.95);
  }

  /* --- –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä—ã --- */
  .progress-bar {
    position: relative;
    width: 100%;
    height: 20px;
    border-radius: 10px;
    background: #161b22;
    box-shadow: inset 0 0 6px #0af8;
    margin-bottom: 15px;
    overflow: hidden;
  }
  .progress-bar-inner {
    height: 100%;
    border-radius: 10px;
    background: linear-gradient(90deg, #4ade80, #22c55e);
    box-shadow: 0 0 8px #22c55ecc;
    transition: width 0.3s ease;
  }

  /* --- –ú–∞–≥–∞–∑–∏–Ω --- */
  #shop {
    position: absolute;
    top: 10px;
    right: 10px;
    width: 350px;
    max-height: 90vh;
    background: rgba(17, 24, 39, 0.9);
    border-radius: 14px;
    box-shadow: 0 0 20px #10b981;
    padding: 20px;
    overflow-y: auto;
    color: #a7f3d0;
    display: none;
    z-index: 101;
  }
  #shop h2 {
    margin: 0 0 15px 0;
    text-align: center;
    font-weight: 700;
    font-size: 22px;
    color: #14b8a6;
    text-shadow: 0 0 8px #14b8a6cc;
  }
  .shop-item {
    background: #065f46;
    padding: 15px;
    margin-bottom: 12px;
    border-radius: 12px;
    box-shadow: 0 0 12px #059669cc;
    cursor: pointer;
    transition: background 0.25s ease;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .shop-item:hover {
    background: #10b981;
    color: #0f172a;
    box-shadow: 0 0 20px #10b981ee;
  }
  .shop-item span {
    font-weight: 600;
  }

  /* --- –¢–∞–±–ª–∏—Ü–∞ —Ä–µ–∫–æ—Ä–¥–æ–≤ --- */
  #leaderboard {
    position: absolute;
    bottom: 10px;
    left: 10px;
    width: 320px;
    background: rgba(12, 17, 23, 0.85);
    border-radius: 14px;
    box-shadow: 0 0 20px #2563eb;
    padding: 15px;
    font-size: 14px;
    color: #93c5fd;
    user-select: none;
  }
  #leaderboard h3 {
    margin: 0 0 10px 0;
    color: #60a5fa;
    font-weight: 700;
    text-align: center;
    text-shadow: 0 0 6px #60a5fa;
  }
  #leaderboard ol {
    padding-left: 20px;
    margin: 0;
  }

  /* --- –ú–∏—Å—Å–∏–∏ --- */
  #missions {
    position: absolute;
    bottom: 10px;
    right: 10px;
    width: 320px;
    background: rgba(12, 17, 23, 0.85);
    border-radius: 14px;
    box-shadow: 0 0 20px #4ade80;
    padding: 15px;
    font-size: 14px;
    color: #a7f3d0;
    user-select: none;
  }
  #missions h3 {
    margin: 0 0 10px 0;
    color: #22c55e;
    font-weight: 700;
    text-align: center;
    text-shadow: 0 0 6px #22c55e;
  }
  #missions ul {
    margin: 0;
    padding-left: 20px;
  }
  #missions li {
    margin-bottom: 8px;
  }
  #missions li.completed {
    text-decoration: line-through;
    color: #6ee7b7;
  }

  /* --- –ó–≤—É–∫–æ–≤—ã–µ –∫–Ω–æ–ø–∫–∏ --- */
  #sound-controls {
    position: absolute;
    top: 10px;
    right: 380px;
    z-index: 101;
    display: flex;
    gap: 10px;
  }
  #sound-controls button {
    width: 40px; height: 40px;
    padding: 0;
    font-size: 20px;
    border-radius: 50%;
    box-shadow: 0 0 10px #2563eb;
  }
  #sound-controls button:hover {
    box-shadow: 0 0 15px #60a5fa;
  }

</style>
</head>
<body>

<canvas id="gameCanvas"></canvas>

<div id="ui">
  <h1>Coal Mine Clicker</h1>
  <div id="resources">
    <div class="res-line"><img src="https://cdn-icons-png.flaticon.com/512/3208/3208721.png" alt="–£–≥–æ–ª—å"> –£–≥–æ–ª—å: <span id="coal-count">0</span></div>
    <div class="res-line"><img src="https://cdn-icons-png.flaticon.com/512/854/854878.png" alt="–ö–∏—Ä–∫–∞"> –ö–∏—Ä–∫–∞: <span id="pickaxe-level">1</span></div>
    <div class="res-line">–£—Ä–æ–≤–µ–Ω—å: <span id="player-level">1</span></div>
    <div class="res-line">–û–ø—ã—Ç: 
      <div class="progress-bar" style="flex-grow:1; margin-left:10px; margin-right:10px;">
        <div id="xp-bar" class="progress-bar-inner" style="width:0%;"></div>
      </div>
      <span id="xp-text">0 / 100</span>
    </div>
    <div class="res-line">–î–æ–±—ã—á–∞ –∑–∞ –∫–ª–∏–∫: <span id="click-power">1</span></div>
    <div class="res-line">–ê–≤—Ç–æ–¥–æ–±—ã—á–∞ –≤ —Å–µ–∫: <span id="auto-mining">0</span></div>
  </div>
  <button id="btn-mine">–î–æ–±—ã—Ç—å —É–≥–æ–ª—å</button>
  <button id="btn-upgrade-pickaxe">–£–ª—É—á—à–∏—Ç—å –∫–∏—Ä–∫—É (100 —É–≥–ª—è)</button>
  <button id="btn-toggle-shop">–ú–∞–≥–∞–∑–∏–Ω</button>
</div>

<div id="shop">
  <h2>–ú–∞–≥–∞–∑–∏–Ω —É–ª—É—á—à–µ–Ω–∏–π</h2>
  <div id="shop-items"></div>
  <button id="btn-close-shop">–ó–∞–∫—Ä—ã—Ç—å –º–∞–≥–∞–∑–∏–Ω</button>
</div>

<div id="leaderboard">
  <h3>–¢–∞–±–ª–∏—Ü–∞ —Ä–µ–∫–æ—Ä–¥–æ–≤</h3>
  <ol id="leaderboard-list">
    <!-- –ó–∞–ø–∏—Å–∏ —Å—é–¥–∞ -->
  </ol>
</div>

<div id="missions">
  <h3>–ú–∏—Å—Å–∏–∏</h3>
  <ul id="missions-list"></ul>
</div>

<div id="sound-controls">
  <button id="btn-sound-toggle" title="–í–∫–ª/–í—ã–∫–ª –∑–≤—É–∫">üîà</button>
  <button id="btn-music-toggle" title="–í–∫–ª/–í—ã–∫–ª –º—É–∑—ã–∫—É">üéµ</button>
</div>

<script>
(() => {
  // --- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ ---
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');
  let W, H;

  // –†–µ—Å—É—Ä—Å—ã
  let coal = 0;
  let pickaxeLevel = 1;
  let playerLevel = 1;
  let currentXP = 0;
  let xpToNextLevel = 100;
  let clickPower = 1;
  let autoMining = 0;

  // –ú–∞–≥–∞–∑–∏–Ω
  const shopItemsData = [
    { id: 'autoMiner', name: '–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–æ–±—ã—á–∞', cost: 500, effect: () => { autoMining += 1; }, description: '–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±—ã–≤–∞—Ç—å 1 —É–≥–æ–ª—å –≤ —Å–µ–∫—É–Ω–¥—É' },
    { id: 'xpBoost', name: '–£—Å–∫–æ—Ä–µ–Ω–∏–µ –æ–ø—ã—Ç–∞', cost: 750, effect: () => { xpGainMultiplier *= 1.5; }, description: '–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –æ–ø—ã—Ç –∑–∞ –∫–ª–∏–∫ –Ω–∞ 50%' },
    { id: 'doubleClick', name: '–£–¥–≤–æ–µ–Ω–∏–µ –¥–æ–±—ã—á–∏', cost: 1000, effect: () => { clickPower *= 2; }, description: '–£–¥–≤–∞–∏–≤–∞–µ—Ç –¥–æ–±—ã—á—É —É–≥–ª—è –∑–∞ –∫–ª–∏–∫' },
    { id: 'superPickaxe', name: '–°—É–ø–µ—Ä –∫–∏—Ä–∫–∞', cost: 1500, effect: () => { pickaxeLevel += 5; updateClickPower(); }, description: '–ë–æ–ª—å—à–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ –∫–∏—Ä–∫–∏ (+5 —É—Ä–æ–≤–Ω–µ–π)' },
  ];
  let purchasedItems = new Set();

  // –ó–≤—É–∫–∏
  let soundOn = true;
  let musicOn = true;
  let audioCtx;
  let sounds = {};
  let musicSource;

  // –ú–∏—Å—Å–∏–∏
  const missions = [
    { id: 'mine10', text: '–î–æ–±—ã—Ç—å 10 —É–≥–ª—è', target: 10, progress: 0, completed: false, reward: 50 },
    { id: 'mine100', text: '–î–æ–±—ã—Ç—å 100 —É–≥–ª—è', target: 100, progress: 0, completed: false, reward: 200 },
    { id: 'level5', text: '–î–æ—Å—Ç–∏—á—å 5 —É—Ä–æ–≤–Ω—è', target: 5, progress: 0, completed: false, reward: 500 },
  ];

  // –¢–∞–±–ª–∏—Ü–∞ —Ä–µ–∫–æ—Ä–¥–æ–≤ (–ø—Ä–æ—Å—Ç–æ–π –º–∞—Å—Å–∏–≤)
  let leaderboard = [];

  // –û–ø—ã—Ç–Ω—ã–π –º–Ω–æ–∂–∏—Ç–µ–ª—å
  let xpGainMultiplier = 1;

  // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞–Ω–≤–∞—Å–∞ ---
  function resize() {
    W = window.innerWidth;
    H = window.innerHeight;
    canvas.width = W;
    canvas.height = H;
  }
  window.addEventListener('resize', resize);
  resize();

  // --- –ó–≤—É–∫–∏ ---
  function playSound(name, volume = 0.2) {
    if (!soundOn) return;
    const snd = sounds[name];
    if (!snd) return;
    const source = audioCtx.createBufferSource();
    source.buffer = snd;
    const gainNode = audioCtx.createGain();
    gainNode.gain.value = volume;
    source.connect(gainNode).connect(audioCtx.destination);
    source.start(0);
  }
  function loadSound(url, name) {
    fetch(url)
      .then(r => r.arrayBuffer())
      .then(buffer => audioCtx.decodeAudioData(buffer))
      .then(decoded => {
        sounds[name] = decoded;
      });
  }
  function initAudio() {
    try {
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      loadSound('https://freesound.org/data/previews/82/82669_1022651-lq.mp3', 'click');
      loadSound('https://freesound.org/data/previews/331/331912_3248244-lq.mp3', 'levelup');
    } catch {
      console.warn('Web Audio API not supported');
    }
  }

  // –§–æ–Ω–æ–≤–∞—è –º—É–∑—ã–∫–∞ (loop)
  function playMusic() {
    if (!musicOn) return;
    if (musicSource) musicSource.stop();
    const oscillator = audioCtx.createOscillator();
    const gainNode = audioCtx.createGain();
    oscillator.type = 'sine';
    oscillator.frequency.value = 220;
    oscillator.connect(gainNode);
    gainNode.connect(audioCtx.destination);
    gainNode.gain.value = 0.03;
    oscillator.start();
    musicSource = oscillator;
  }
  function stopMusic() {
    if (musicSource) {
      musicSource.stop();
      musicSource = null;
    }
  }

  // --- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI ---
  function updateUI() {
    document.getElementById('coal-count').textContent = coal.toFixed(0);
    document.getElementById('pickaxe-level').textContent = pickaxeLevel;
    document.getElementById('player-level').textContent = playerLevel;
    document.getElementById('click-power').textContent = clickPower;
    document.getElementById('auto-mining').textContent = autoMining;

    const xpBar = document.getElementById('xp-bar');
    const xpText = document.getElementById('xp-text');
    let xpPercent = Math.min(100, (currentXP / xpToNextLevel) * 100);
    xpBar.style.width = xpPercent + '%';
    xpText.textContent = `${currentXP} / ${xpToNextLevel}`;

    updateMissionsUI();
    updateLeaderboardUI();
  }

  // --- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–∏—Å—Å–∏–π ---
  function updateMissionsUI() {
    const ul = document.getElementById('missions-list');
    ul.innerHTML = '';
    missions.forEach(mission => {
      const li = document.createElement('li');
      li.textContent = mission.text + ` (${Math.min(mission.progress, mission.target)} / ${mission.target})`;
      if (mission.completed) li.classList.add('completed');
      ul.appendChild(li);
    });
  }

  // --- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã —Ä–µ–∫–æ—Ä–¥–æ–≤ ---
  function updateLeaderboardUI() {
    const ol = document.getElementById('leaderboard-list');
    ol.innerHTML = '';
    leaderboard.slice(0, 5).forEach(record => {
      const li = document.createElement('li');
      li.textContent = `${record.name}: ${record.score}`;
      ol.appendChild(li);
    });
  }

  // --- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞ ---
  function updateShopUI() {
    const container = document.getElementById('shop-items');
    container.innerHTML = '';
    shopItemsData.forEach(item => {
      const div = document.createElement('div');
      div.className = 'shop-item';
      div.title = item.description;
      div.textContent = `${item.name} ‚Äî ${item.cost} —É–≥–ª—è`;
      if (purchasedItems.has(item.id)) {
        div.style.background = '#064e3b';
        div.style.color = '#6ee7b7';
        div.textContent += ' (–∫—É–ø–ª–µ–Ω–æ)';
        div.style.cursor = 'default';
      } else if (coal < item.cost) {
        div.style.background = '#4b5563';
        div.style.color = '#9ca3af';
        div.style.cursor = 'not-allowed';
      }
      div.addEventListener('click', () => {
        if (coal >= item.cost && !purchasedItems.has(item.id)) {
          coal -= item.cost;
          purchasedItems.add(item.id);
          item.effect();
          updateClickPower();
          updateUI();
          updateShopUI();
          playSound('click');
        }
      });
      container.appendChild(div);
    });
  }

  // --- –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–∫–∞—á–∫–∏ –∫–∏—Ä–∫–∏ ---
  function updateClickPower() {
    clickPower = pickaxeLevel * 1;
    // –ï—Å–ª–∏ –∫—É–ø–ª–µ–Ω doubleClick, clickPower —É–∂–µ —É–º–Ω–æ–∂–µ–Ω –≤ —ç—Ñ—Ñ–µ–∫—Ç–µ
  }

  // --- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–ø—ã—Ç–∞ –∏ —É—Ä–æ–≤–Ω—è ---
  function addXP(amount) {
    currentXP += amount * xpGainMultiplier;
    if (currentXP >= xpToNextLevel) {
      currentXP -= xpToNextLevel;
      playerLevel++;
      xpToNextLevel = Math.floor(xpToNextLevel * 1.4);
      playSound('levelup', 0.4);
      addClickPowerOnLevelUp();
      checkMissions();
    }
    updateUI();
  }
  function addClickPowerOnLevelUp() {
    pickaxeLevel++;
    updateClickPower();
  }

  // --- –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏—Å—Å–∏–π ---
  function checkMissions() {
    missions.forEach(m => {
      if (!m.completed) {
        if ((m.id.startsWith('mine') && coal >= m.target) ||
            (m.id === 'level5' && playerLevel >= m.target)) {
          m.completed = true;
          coal += m.reward;
          playSound('levelup', 0.6);
          alert(`–ú–∏—Å—Å–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞: "${m.text}". –í—ã –ø–æ–ª—É—á–∏–ª–∏ ${m.reward} —É–≥–ª—è!`);
          updateUI();
        }
      }
    });
  }

  // --- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–æ–±—ã—á–∏ ---
  function mine() {
    coal += clickPower;
    addXP(5);
    updateUI();
    checkMissions();
    playSound('click');
  }

  // --- –ê–≤—Ç–æ–¥–æ–±—ã—á–∞ ---
  function autoMineTick() {
    coal += autoMining;
    if (autoMining > 0) addXP(autoMining * 2);
    updateUI();
    checkMissions();
  }

  // --- –°–æ–±—ã—Ç–∏—è –∫–Ω–æ–ø–æ–∫ ---
  document.getElementById('btn-mine').addEventListener('click', () => {
    if (!audioCtx) initAudio();
    mine();
  });

  document.getElementById('btn-upgrade-pickaxe').addEventListener('click', () => {
    if (coal >= 100) {
      coal -= 100;
      pickaxeLevel++;
      updateClickPower();
      updateUI();
      playSound('click');
      checkMissions();
    } else {
      alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —É–≥–ª—è –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∫–∏—Ä–∫–∏!');
    }
  });

  document.getElementById('btn-toggle-shop').addEventListener('click', () => {
    const shop = document.getElementById('shop');
    if (shop.style.display === 'block') {
      shop.style.display = 'none';
    } else {
      updateShopUI();
      shop.style.display = 'block';
    }
  });

  document.getElementById('btn-close-shop').addEventListener('click', () => {
    document.getElementById('shop').style.display = 'none';
  });

  // --- –ó–≤—É–∫–æ–≤—ã–µ –∫–Ω–æ–ø–∫–∏ ---
  document.getElementById('btn-sound-toggle').addEventListener('click', () => {
    soundOn = !soundOn;
    document.getElementById('btn-sound-toggle').textContent = soundOn ? 'üîà' : 'üîá';
  });

  document.getElementById('btn-music-toggle').addEventListener('click', () => {
    musicOn = !musicOn;
    document.getElementById('btn-music-toggle').textContent = musicOn ? 'üéµ' : 'üîï';
    if (musicOn) playMusic();
    else stopMusic();
  });

  // --- –†–∏—Å—É–µ–º –∫—Ä–∞—Å–∏–≤—ã–π —à–∞—Ö—Ç—ë—Ä—Å–∫–∏–π —Ñ–æ–Ω —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π ---
  const stars = [];
  for(let i=0; i<150; i++) {
    stars.push({
      x: Math.random()*W,
      y: Math.random()*H,
      r: Math.random()*1.5,
      speed: Math.random()*0.2 + 0.02,
      phase: Math.random()*Math.PI*2,
    });
  }

  function drawBackground() {
    ctx.clearRect(0, 0, W, H);

    // –ó–≤—ë–∑–¥—ã –º–µ—Ä—Ü–∞—é—Ç
    stars.forEach(star => {
      star.phase += star.speed;
      const brightness = (Math.sin(star.phase) + 1)/2;
      ctx.beginPath();
      ctx.fillStyle = `rgba(80,180,255,${brightness.toFixed(2)})`;
      ctx.shadowColor = `rgba(80,180,255,${brightness.toFixed(2)})`;
      ctx.shadowBlur = 10;
      ctx.arc(star.x, star.y, star.r, 0, Math.PI*2);
      ctx.fill();
    });

    // –ó–µ–º–ª—è –∏ —à–∞—Ö—Ç–∞
    let groundHeight = H * 0.2;
    ctx.fillStyle = '#4b5563';
    ctx.fillRect(0, H - groundHeight, W, groundHeight);

    // –®–∞—Ö—Ç–∞ (–¥–µ—Ä–µ–≤—è–Ω–Ω—ã–µ –±–∞–ª–∫–∏)
    const shaftWidth = 250;
    const shaftX = W/2 - shaftWidth/2;
    ctx.fillStyle = '#3b3f45';
    ctx.fillRect(shaftX, H - groundHeight, shaftWidth, groundHeight);

    // –î–µ—Ä–µ–≤—è–Ω–Ω—ã–µ –±–∞–ª–∫–∏ —à–∞—Ö—Ç—ã
    ctx.strokeStyle = '#7c6f59';
    ctx.lineWidth = 12;
    for (let i = 0; i < 6; i++) {
      let y = H - groundHeight + i*(groundHeight/6);
      ctx.beginPath();
      ctx.moveTo(shaftX, y);
      ctx.lineTo(shaftX + shaftWidth, y);
      ctx.stroke();
    }
    ctx.lineWidth = 8;
    for (let i = 1; i < 6; i++) {
      let x = shaftX + i*(shaftWidth/6);
      ctx.beginPath();
      ctx.moveTo(x, H - groundHeight);
      ctx.lineTo(x, H);
      ctx.stroke();
    }
  }

  // --- –ê–Ω–∏–º–∞—Ü–∏—è –∫–ª–∏–∫–∞ ---
  let clickEffects = [];
  function addClickEffect(x, y) {
    clickEffects.push({x, y, alpha: 1, size: 30});
  }
  function drawClickEffects() {
    for (let i = clickEffects.length - 1; i >= 0; i--) {
      const e = clickEffects[i];
      ctx.save();
      ctx.globalAlpha = e.alpha;
      ctx.fillStyle = '#22c55e';
      ctx.shadowColor = '#22c55e';
      ctx.shadowBlur = 10;
      ctx.beginPath();
      ctx.arc(e.x, e.y, e.size, 0, Math.PI * 2);
      ctx.fill();
      ctx.restore();
      e.alpha -= 0.03;
      e.size += 0.8;
      if (e.alpha <= 0) clickEffects.splice(i, 1);
    }
  }

  // --- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∫–ª–∏–∫–∞ –Ω–∞ –∫–∞–Ω–≤–∞—Å–µ ---
  canvas.addEventListener('click', e => {
    const rect = canvas.getBoundingClientRect();
    addClickEffect(e.clientX - rect.left, e.clientY - rect.top);
  });

  // --- –û—Å–Ω–æ–≤–Ω–æ–π –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª ---
  function gameLoop() {
    drawBackground();
    drawClickEffects();
    requestAnimationFrame(gameLoop);
  }

  // --- –ê–≤—Ç–æ–¥–æ–±—ã—á–∞ ---
  setInterval(autoMineTick, 1000);

  // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ---
  updateClickPower();
  updateUI();

  // –ó–∞–ø—É—Å–∫–∞–µ–º –º—É–∑—ã–∫—É –∏ –∞—É–¥–∏–æ
  initAudio();
  playMusic();

  gameLoop();
})();
</script>

</body>
</html>

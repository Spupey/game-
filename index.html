<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>Игра Шахта — расширенный фон</title>
<style>
  body {
    margin: 0;
    background: #0f1626;
    color: #ddd;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    overflow: hidden;
    user-select: none;
  }
  #gameCanvas {
    display: block;
    margin: auto;
    background: #1b223b;
    box-shadow: 0 0 20px #000a;
    border-radius: 12px;
    position: relative;
    top: 20px;
  }
  #infoPanel {
    position: absolute;
    top: 20px; left: 50%;
    transform: translateX(-50%);
    width: 320px;
    padding: 12px;
    background: rgba(20, 30, 60, 0.85);
    border-radius: 8px;
    box-shadow: 0 0 15px #4466ccaa;
  }
  #infoPanel h2 {
    margin: 0 0 8px 0;
    text-align: center;
  }
</style>
</head>
<body>

<div id="infoPanel">
  <h2>Шахта — уголь и инструменты</h2>
  <p>Нажмите по углю, чтобы добыть.</p>
</div>

<canvas id="gameCanvas" width="600" height="400"></canvas>

<script>
(() => {
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');

  // --- Параметры и состояние ---
  let sparkle = 0;
  let fireFlamePhase = 0;
  const particles = [];

  // Создаем частицы для эффекта падающего угля/искорок
  function createParticle() {
    return {
      x: Math.random() * canvas.width,
      y: -10,
      size: 1 + Math.random() * 2,
      speedY: 0.7 + Math.random(),
      alpha: 1,
      decay: 0.005 + Math.random() * 0.007,
      color: 'rgba(100, 100, 110, 0.8)'
    };
  }

  // Иконки - небольшие svg-подобные рисунки на canvas
  function drawPickaxe(x, y, scale = 1) {
    ctx.save();
    ctx.translate(x, y);
    ctx.scale(scale, scale);
    ctx.lineWidth = 2;
    ctx.strokeStyle = '#bbb';
    ctx.fillStyle = '#666';

    // Рукоять
    ctx.beginPath();
    ctx.moveTo(0, 0);
    ctx.lineTo(20, 70);
    ctx.stroke();

    // Лезвие
    ctx.beginPath();
    ctx.moveTo(15, 20);
    ctx.lineTo(35, 5);
    ctx.lineTo(30, 15);
    ctx.lineTo(40, 25);
    ctx.lineTo(15, 40);
    ctx.closePath();
    ctx.fill();
    ctx.stroke();

    ctx.restore();
  }

  function drawBucket(x, y, scale=1) {
    ctx.save();
    ctx.translate(x, y);
    ctx.scale(scale, scale);
    ctx.fillStyle = '#444';
    ctx.strokeStyle = '#222';
    ctx.lineWidth = 2;

    // Ведро
    ctx.beginPath();
    ctx.moveTo(0,0);
    ctx.lineTo(40,0);
    ctx.lineTo(35,50);
    ctx.lineTo(5,50);
    ctx.closePath();
    ctx.fill();
    ctx.stroke();

    // Ручка
    ctx.beginPath();
    ctx.moveTo(0,0);
    ctx.quadraticCurveTo(20,-20,40,0);
    ctx.stroke();

    ctx.restore();
  }

  function drawTorch(x, y, scale=1, flamePhase=0) {
    ctx.save();
    ctx.translate(x, y);
    ctx.scale(scale, scale);

    // Деревянная часть
    ctx.fillStyle = '#7a5230';
    ctx.fillRect(-5, 0, 10, 60);

    // Огнём рисуем анимированный пламень
    const flameHeight = 30 + 5 * Math.sin(flamePhase);
    const flameWidth = 15 + 3 * Math.cos(flamePhase * 2);

    let grad = ctx.createRadialGradient(0, 0, 5, 0, -flameHeight/2, flameWidth);
    grad.addColorStop(0, 'rgba(255, 200, 50, 1)');
    grad.addColorStop(0.5, 'rgba(255, 100, 0, 0.7)');
    grad.addColorStop(1, 'rgba(0,0,0,0)');

    ctx.fillStyle = grad;
    ctx.beginPath();
    ctx.ellipse(0, -flameHeight/2, flameWidth, flameHeight, 0, 0, 2 * Math.PI);
    ctx.fill();

    ctx.restore();
  }

  // Фоновые блоки (камни, уголь, дерево)
  function drawBackgroundBlocks() {
    // Камень - серые квадраты
    for(let i=0; i<8; i++) {
      const size = 30;
      let x = i * 70 + 20 + 10 * Math.sin(i + sparkle);
      let y = 320 + 10 * Math.cos(i + sparkle * 0.5);
      ctx.fillStyle = '#5a5a6a';
      ctx.fillRect(x, y, size, size);

      // Немного текстуры
      ctx.strokeStyle = '#4a4a5a';
      ctx.lineWidth = 1;
      ctx.beginPath();
      ctx.moveTo(x+5,y+5);
      ctx.lineTo(x+size-5,y+size-5);
      ctx.moveTo(x+size-5,y+5);
      ctx.lineTo(x+5,y+size-5);
      ctx.stroke();
    }

    // Уголь — черные с блеском
    for(let i=0; i<6; i++) {
      const size = 20;
      let x = 60 + i * 90 + 12 * Math.cos(i + sparkle * 0.7);
      let y = 280 + 7 * Math.sin(i * 2 + sparkle);
      ctx.fillStyle = '#111111';
      ctx.shadowColor = '#333';
      ctx.shadowBlur = 10;
      ctx.fillRect(x, y, size, size);

      ctx.shadowBlur = 0;
      ctx.fillStyle = '#222';
      ctx.fillRect(x+5, y+5, size-10, size-10);
    }

    // Дерево — коричневые бревна
    for(let i=0; i<4; i++) {
      const w = 60;
      const h = 20;
      let x = 100 + i * 120 + 8 * Math.sin(i + sparkle * 0.3);
      let y = 350 + 5 * Math.cos(i + sparkle * 0.6);
      ctx.fillStyle = '#6a4320';
      ctx.shadowColor = '#503314';
      ctx.shadowBlur = 5;
      ctx.fillRect(x, y, w, h);

      ctx.shadowBlur = 0;
      // Кольца дерева
      ctx.strokeStyle = '#855c38';
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.ellipse(x + w/2, y + h/2, w/3, h/2.5, 0, 0, Math.PI * 2);
      ctx.stroke();
    }
  }

  // Главный объект - уголь с мерцанием и светом
  function drawCoal() {
    const coalX = canvas.width / 2 - 40;
    const coalY = canvas.height / 2 - 60;

    // Тень и свет
    ctx.shadowColor = '#222';
    ctx.shadowBlur = 20;
    ctx.fillStyle = `rgba(17, 17, 17, ${0.8 + 0.2 * Math.sin(sparkle)})`;
    ctx.beginPath();
    ctx.moveTo(coalX + 10, coalY + 10);
    ctx.lineTo(coalX + 40, coalY + 15);
    ctx.lineTo(coalX + 50, coalY + 30);
    ctx.lineTo(coalX + 40, coalY + 50);
    ctx.lineTo(coalX + 10, coalY + 55);
    ctx.lineTo(coalX + 0, coalY + 30);
    ctx.closePath();
    ctx.fill();

    // Светлая грань
    ctx.shadowBlur = 0;
    ctx.fillStyle = '#555';
    ctx.beginPath();
    ctx.moveTo(coalX + 20, coalY + 20);
    ctx.lineTo(coalX + 30, coalY + 22);
    ctx.lineTo(coalX + 28, coalY + 35);
    ctx.lineTo(coalX + 18, coalY + 33);
    ctx.closePath();
    ctx.fill();
  }

  // Анимация искр (частицы падающего угля)
  function updateParticles() {
    if(particles.length < 30 && Math.random() < 0.3) {
      particles.push(createParticle());
    }

    for(let i=particles.length - 1; i >= 0; i--) {
      const p = particles[i];
      p.y += p.speedY;
      p.alpha -= p.decay;

      if(p.alpha <= 0 || p.y > canvas.height) {
        particles.splice(i, 1);
        continue;
      }

      ctx.fillStyle = `rgba(100, 100, 110, ${p.alpha})`;
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
      ctx.fill();
    }
  }

  // Основной цикл рисования
  function draw() {
    // Фон с градиентом (глубина шахты)
    const grad = ctx.createLinearGradient(0, 0, 0, canvas.height);
    grad.addColorStop(0, '#1a2237');
    grad.addColorStop(0.7, '#0d121f');
    grad.addColorStop(1, '#070a13');
    ctx.fillStyle = grad;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    drawBackgroundBlocks();

    drawCoal();

    // Иконки инструментов слева и справа
    drawPickaxe(80, 200, 1.5);
    drawBucket(500, 260, 1.5);
    drawTorch(50, 50, 1.3, fireFlamePhase);
    drawTorch(550, 50, 1.3, fireFlamePhase + Math.PI);

    updateParticles();

    sparkle += 0.07;
    fireFlamePhase += 0.12;

    requestAnimationFrame(draw);
  }

  draw();

  // Клик по канвасу для добычи угля
  canvas.addEventListener('click', (e) => {
    const rect = canvas.getBoundingClientRect();
    const clickX = e.clientX - rect.left;
    const clickY = e.clientY - rect.top;

    // Проверим попадает ли клик на уголь (примерно область)
    const coalX = canvas.width / 2 - 40;
    const coalY = canvas.height / 2 - 60;
    if(clickX >= coalX && clickX <= coalX + 50 &&
       clickY >= coalY && clickY <= coalY + 55) {
      alert('Добыт уголь!'); // заглушка, тут можно добавлять логику игры
    }
  });

})();
</script>

</body>
</html>

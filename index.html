<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Idle Miner Game ‚Äî —Å –≥—Ä–∞—Ñ–∏–∫–æ–π</title>
  <style>
    body {
      margin: 0; background: #0f172a; color: #cbd5e1; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      user-select: none;
      overflow-x: hidden;
    }
    #game {
      max-width: 960px;
      margin: 10px auto;
      padding: 15px;
      background: linear-gradient(145deg, #1e293b, #334155);
      border-radius: 10px;
      box-shadow: 0 0 15px #0ea5e9aa;
    }
    h1 {
      text-align: center;
      color: #38bdf8;
      margin-bottom: 8px;
    }
    #resources {
      display: flex;
      justify-content: space-around;
      margin-bottom: 10px;
      gap: 15px;
      flex-wrap: wrap;
    }
    .res-line {
      display: flex;
      align-items: center;
      background: #334155;
      border-radius: 8px;
      padding: 6px 12px;
      box-shadow: inset 0 0 8px #0ea5e9aa;
      min-width: 150px;
      font-weight: 600;
      font-size: 1.1em;
      gap: 8px;
    }
    .icon {
      width: 28px;
      height: 28px;
      flex-shrink: 0;
    }
    #xp-bar-container {
      flex-grow: 1;
      background: #475569;
      border-radius: 6px;
      height: 18px;
      margin: 0 8px;
      box-shadow: inset 0 0 8px #0ea5e9aa;
      position: relative;
      overflow: hidden;
    }
    #xp-bar {
      background: linear-gradient(90deg, #22c55e, #0f9d58);
      height: 100%;
      width: 0%;
      border-radius: 6px 0 0 6px;
      transition: width 0.3s ease;
      box-shadow: 0 0 6px #22c55eaa;
    }
    #xp-text {
      font-size: 0.9em;
      color: #a7f3d0;
      width: 75px;
      text-align: center;
      font-weight: 600;
      user-select: none;
    }
    button {
      background: #0ea5e9;
      border: none;
      padding: 12px 20px;
      margin: 6px 4px;
      border-radius: 8px;
      font-weight: 700;
      color: #e0f2fe;
      cursor: pointer;
      box-shadow: 0 0 15px #0ea5e9aa;
      transition: background-color 0.3s ease;
      user-select: none;
    }
    button:hover:not(:disabled) {
      background: #38bdf8;
      box-shadow: 0 0 20px #38bdf8cc;
    }
    button:disabled {
      background: #475569;
      cursor: not-allowed;
      box-shadow: none;
    }
    #shop {
      background: #1e293b;
      padding: 15px;
      border-radius: 12px;
      margin-top: 15px;
      display: none;
      box-shadow: 0 0 15px #0ea5e9aa;
    }
    .shop-item {
      background: #334155;
      margin: 8px 0;
      padding: 10px 14px;
      border-radius: 10px;
      cursor: pointer;
      box-shadow: inset 0 0 10px #0ea5e9aa;
      user-select: none;
      font-weight: 600;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: background-color 0.3s ease;
    }
    .shop-item:hover:not(.bought):not(.disabled) {
      background: #22c55eaa;
      color: #071f0f;
      box-shadow: 0 0 12px #22c55eaa;
    }
    .shop-item.bought {
      background: #064e3b;
      color: #6ee7b7;
      cursor: default;
      box-shadow: inset 0 0 12px #22c55eaa;
    }
    .shop-item.disabled {
      background: #475569;
      cursor: not-allowed;
      color: #94a3b8;
      box-shadow: none;
    }
    #missions, #leaderboard {
      margin-top: 20px;
      background: #334155;
      border-radius: 12px;
      padding: 12px 18px;
      box-shadow: 0 0 10px #0ea5e9aa;
    }
    #missions h3, #leaderboard h3 {
      color: #38bdf8;
      margin-top: 0;
    }
    #missions-list li {
      list-style: none;
      padding: 6px 0;
      font-weight: 600;
      border-bottom: 1px solid #475569;
      user-select: none;
      transition: color 0.3s ease;
    }
    #missions-list li.completed {
      color: #22c55e;
      font-weight: 700;
      text-decoration: line-through;
    }
    #leaderboard-list li {
      list-style: decimal;
      margin-left: 20px;
      font-weight: 600;
      user-select: none;
      color: #a7f3d0;
      padding: 4px 0;
    }
    #sound-controls {
      margin-top: 15px;
      display: flex;
      justify-content: center;
      gap: 20px;
    }
    #sound-controls button {
      font-size: 1.5em;
      padding: 6px 14px;
      background: transparent;
      box-shadow: none;
      color: #38bdf8;
      transition: color 0.3s ease;
    }
    #sound-controls button:hover {
      color: #22c55e;
    }
    #gameCanvas {
      display: block;
      margin: 15px auto;
      background: #0f172a;
      border-radius: 12px;
      box-shadow: 0 0 25px #0ea5e9aa;
      max-width: 100%;
    }
  </style>
</head>
<body>
<div id="game">
  <h1>Idle Miner Game ‚Äî —Å –≥—Ä–∞—Ñ–∏–∫–æ–π</h1>
  <div id="resources">
    <div class="res-line">
      <canvas class="icon" id="icon-coal" width="28" height="28"></canvas>
      –£–≥–æ–ª—å: <span id="coal-count">0</span>
    </div>
    <div class="res-line">
      <canvas class="icon" id="icon-pickaxe" width="28" height="28"></canvas>
      –ö–∏—Ä–∫–∞: <span id="pickaxe-level">1</span>
    </div>
    <div class="res-line">
      –£—Ä–æ–≤–µ–Ω—å: <span id="player-level">1</span>
    </div>
    <div class="res-line" style="flex-grow:1; min-width: 250px;">
      –û–ø—ã—Ç:
      <div id="xp-bar-container">
        <div id="xp-bar"></div>
      </div>
      <span id="xp-text">0 / 100</span>
    </div>
  </div>

  <div id="resources">
    <div class="res-line">
      –î–æ–±—ã—á–∞ –∑–∞ –∫–ª–∏–∫: <span id="click-power">1</span>
    </div>
    <div class="res-line">
      –ê–≤—Ç–æ–¥–æ–±—ã—á–∞ –≤ —Å–µ–∫: <span id="auto-mining">0</span>
    </div>
  </div>

  <button id="btn-mine">–î–æ–±—ã—Ç—å —É–≥–æ–ª—å</button>
  <button id="btn-upgrade-pickaxe">–£–ª—É—á—à–∏—Ç—å –∫–∏—Ä–∫—É (100 —É–≥–ª—è)</button>
  <button id="btn-toggle-shop">–ú–∞–≥–∞–∑–∏–Ω</button>

  <canvas id="gameCanvas" width="640" height="360"></canvas>

  <div id="shop">
    <h2>–ú–∞–≥–∞–∑–∏–Ω —É–ª—É—á—à–µ–Ω–∏–π</h2>
    <div id="shop-items"></div>
    <button id="btn-close-shop">–ó–∞–∫—Ä—ã—Ç—å –º–∞–≥–∞–∑–∏–Ω</button>
  </div>

  <div id="missions">
    <h3>–ú–∏—Å—Å–∏–∏</h3>
    <ul id="missions-list"></ul>
  </div>

  <div id="leaderboard">
    <h3>–¢–∞–±–ª–∏—Ü–∞ —Ä–µ–∫–æ—Ä–¥–æ–≤</h3>
    <ol id="leaderboard-list"></ol>
  </div>

  <div id="sound-controls">
    <button id="btn-sound-toggle" title="–í–∫–ª/–í—ã–∫–ª –∑–≤—É–∫">üîà</button>
    <button id="btn-music-toggle" title="–í–∫–ª/–í—ã–∫–ª –º—É–∑—ã–∫—É">üéµ</button>
  </div>
</div>

<script>
(() => {
  // --- –ù–∞—Ä–∏—Å–æ–≤–∞—Ç—å –∏–∫–æ–Ω–∫—É —É–≥–ª—è ---
  function drawCoalIcon(ctx) {
    ctx.clearRect(0, 0, 28, 28);
    ctx.fillStyle = '#111111';
    ctx.shadowColor = '#333333';
    ctx.shadowBlur = 3;
    ctx.beginPath();
    ctx.moveTo(8, 4);
    ctx.lineTo(20, 5);
    ctx.lineTo(24, 12);
    ctx.lineTo(19, 22);
    ctx.lineTo(8, 24);
    ctx.lineTo(5, 15);
    ctx.closePath();
    ctx.fill();
    // –ë–ª–∏–∫–∏
    ctx.shadowBlur = 0;
    ctx.fillStyle = '#555555';
    ctx.beginPath();
    ctx.moveTo(10, 7);
    ctx.lineTo(14, 8);
    ctx.lineTo(13, 12);
    ctx.lineTo(9, 11);
    ctx.closePath();
    ctx.fill();
  }
  // --- –ù–∞—Ä–∏—Å–æ–≤–∞—Ç—å –∏–∫–æ–Ω–∫—É –∫–∏—Ä–∫–∏ ---
  function drawPickaxeIcon(ctx) {
    ctx.clearRect(0, 0, 28, 28);
    ctx.strokeStyle = '#d1d5db';
    ctx.lineWidth = 3;
    ctx.lineCap = 'round';

    // –†—É—á–∫–∞
    ctx.beginPath();
    ctx.moveTo(9, 21);
    ctx.lineTo(19, 11);
    ctx.stroke();

    // –õ–µ–∑–≤–∏—è
    ctx.beginPath();
    ctx.moveTo(18, 9);
    ctx.lineTo(22, 5);
    ctx.lineTo(23, 7);
    ctx.lineTo(19, 11);
    ctx.stroke();

    ctx.beginPath();
    ctx.moveTo(17, 13);
    ctx.lineTo(21, 17);
    ctx.stroke();
  }
  // --- –ù–∞—Ä–∏—Å–æ–≤–∞—Ç—å –∏–∫–æ–Ω–∫—É –æ–ø—ã—Ç–∞ (–∑–≤—ë–∑–¥–æ—á–∫–∞) ---
  function drawXPIcon(ctx) {
    ctx.clearRect(0, 0, 28, 28);
    ctx.fillStyle = '#22c55e';
    ctx.shadowColor = '#22c55e';
    ctx.shadowBlur = 4;

    const cx = 14, cy = 14;
    const spikes = 5;
    const outerRadius = 12;
    const innerRadius = 5;

    ctx.beginPath();
    for(let i = 0; i < spikes; i++) {
      let rot = Math.PI / 2 * 3 + i * Math.PI / spikes;
      let x = cx + Math.cos(rot) * outerRadius;
      let y = cy + Math.sin(rot) * outerRadius;
      ctx.lineTo(x, y);
      rot += Math.PI / spikes;
      x = cx + Math.cos(rot) * innerRadius;
      y = cy + Math.sin(rot) * innerRadius;
      ctx.lineTo(x, y);
    }
    ctx.closePath();
    ctx.fill();
  }

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–∫–æ–Ω–æ–∫
  drawCoalIcon(document.getElementById('icon-coal').getContext('2d'));
  drawPickaxeIcon(document.getElementById('icon-pickaxe').getContext('2d'));

  // --- –ò–≥—Ä–∞ ---
  const coalCountEl = document.getElementById('coal-count');
  const pickaxeLevelEl = document.getElementById('pickaxe-level');
  const playerLevelEl = document.getElementById('player-level');
  const xpBar = document.getElementById('xp-bar');
  const xpText = document.getElementById('xp-text');
  const clickPowerEl = document.getElementById('click-power');
  const autoMiningEl = document.getElementById('auto-mining');

  const btnMine = document.getElementById('btn-mine');
  const btnUpgradePickaxe = document.getElementById('btn-upgrade-pickaxe');
  const btnToggleShop = document.getElementById('btn-toggle-shop');
  const shop = document.getElementById('shop');
  const shopItemsContainer = document.getElementById('shop-items');
  const btnCloseShop = document.getElementById('btn-close-shop');

  const missionsList = document.getElementById('missions-list');
  const leaderboardList = document.getElementById('leaderboard-list');

  // –ó–≤—É–∫ –∏ –º—É–∑—ã–∫–∞
  let soundOn = true;
  let musicOn = true;
  const btnSoundToggle = document.getElementById('btn-sound-toggle');
  const btnMusicToggle = document.getElementById('btn-music-toggle');

  let coal = 0;
  let pickaxeLevel = 1;
  let playerLevel = 1;
  let currentXP = 0;
  let xpToNextLevel = 100;
  let clickPower = 1;
  let autoMining = 0;

  // –ú–∏—Å—Å–∏–∏ –∏ —É–ª—É—á—à–µ–Ω–∏—è
  const missions = [
    { id:1, text: '–î–æ–±—ã—Ç—å 50 —É–≥–ª—è', target: 50, completed: false, rewardXP: 20 },
    { id:2, text: '–î–æ—Å—Ç–∏—á—å —É—Ä–æ–≤–Ω—è 3', target: 3, completed: false, rewardXP: 50 },
    { id:3, text: '–ö—É–ø–∏—Ç—å –∫–∏—Ä–∫—É 5 —É—Ä–æ–≤–Ω—è', target: 5, completed: false, rewardXP: 80 },
  ];

  const shopItems = [
    { id: 'auto-miner', name: '–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —à–∞—Ö—Ç—ë—Ä', cost: 500, bought: false, effect: () => { autoMining += 1; updateUI(); } },
    { id: 'better-pickaxe', name: '–£–ª—É—á—à–µ–Ω–Ω–∞—è –∫–∏—Ä–∫–∞', cost: 1000, bought: false, effect: () => { pickaxeLevel += 1; clickPower += 3; updateUI(); } },
  ];

  function updateUI() {
    coalCountEl.textContent = coal;
    pickaxeLevelEl.textContent = pickaxeLevel;
    playerLevelEl.textContent = playerLevel;
    clickPowerEl.textContent = clickPower;
    autoMiningEl.textContent = autoMining;

    const xpPercent = Math.min((currentXP / xpToNextLevel) * 100, 100);
    xpBar.style.width = xpPercent + '%';
    xpText.textContent = `${currentXP} / ${xpToNextLevel}`;

    btnUpgradePickaxe.disabled = coal < 100;

    // –û–±–Ω–æ–≤–ª—è–µ–º –º–∞–≥–∞–∑–∏–Ω
    shopItemsContainer.innerHTML = '';
    shopItems.forEach(item => {
      const div = document.createElement('div');
      div.className = 'shop-item';
      if(item.bought) div.classList.add('bought');
      if(coal < item.cost && !item.bought) div.classList.add('disabled');
      div.textContent = `${item.name} ‚Äî ${item.cost} —É–≥–ª—è`;
      if(item.bought) div.textContent += ' (–ö—É–ø–ª–µ–Ω–æ)';
      div.onclick = () => {
        if(item.bought) return;
        if(coal >= item.cost) {
          coal -= item.cost;
          item.bought = true;
          item.effect();
          updateUI();
          checkMissions();
        }
      };
      shopItemsContainer.appendChild(div);
    });

    // –ú–∏—Å—Å–∏–∏
    missionsList.innerHTML = '';
    missions.forEach(m => {
      const li = document.createElement('li');
      li.textContent = m.text;
      if(m.completed) li.classList.add('completed');
      missionsList.appendChild(li);
    });

    // –¢–∞–±–ª–∏—Ü–∞ —Ä–µ–∫–æ—Ä–¥–æ–≤ ‚Äî –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞ –ø—Ä–æ—Å—Ç–æ —Ç–æ–ø-3 —Ñ–∏–∫—Ç–∏–≤–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤
    leaderboardList.innerHTML = '';
    const leaderboard = [
      { name: '–ò–≥—Ä–æ–∫1', coal: 1000 },
      { name: '–ò–≥—Ä–æ–∫2', coal: 700 },
      { name: '–ò–≥—Ä–æ–∫3', coal: 500 },
    ];
    leaderboard.forEach(p => {
      const li = document.createElement('li');
      li.textContent = `${p.name} ‚Äî ${p.coal} —É–≥–ª—è`;
      leaderboardList.appendChild(li);
    });
  }

  function gainXP(amount) {
    currentXP += amount;
    while(currentXP >= xpToNextLevel) {
      currentXP -= xpToNextLevel;
      playerLevel++;
      xpToNextLevel = Math.floor(xpToNextLevel * 1.5);
      // –ü—Ä–∏ –ø–æ–≤—ã—à–µ–Ω–∏–∏ —É—Ä–æ–≤–Ω—è –º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å —á—Ç–æ-—Ç–æ
      clickPower++;
    }
    updateUI();
  }

  function checkMissions() {
    missions.forEach(m => {
      if(m.completed) return;
      let progress = 0;
      if(m.id === 1) progress = coal;
      if(m.id === 2) progress = playerLevel;
      if(m.id === 3) progress = pickaxeLevel;

      if(progress >= m.target) {
        m.completed = true;
        gainXP(m.rewardXP);
      }
    });
  }

  btnMine.onclick = () => {
    coal += clickPower;
    gainXP(2);
    updateUI();
    checkMissions();
    playSound('mine');
  };

  btnUpgradePickaxe.onclick = () => {
    if(coal >= 100) {
      coal -= 100;
      pickaxeLevel++;
      clickPower += 2;
      updateUI();
      checkMissions();
      playSound('upgrade');
    }
  };

  btnToggleShop.onclick = () => {
    if(shop.style.display === 'none') {
      shop.style.display = 'block';
      btnToggleShop.textContent = '–ó–∞–∫—Ä—ã—Ç—å –º–∞–≥–∞–∑–∏–Ω';
    } else {
      shop.style.display = 'none';
      btnToggleShop.textContent = '–ú–∞–≥–∞–∑–∏–Ω';
    }
  };
  btnCloseShop.onclick = () => {
    shop.style.display = 'none';
    btnToggleShop.textContent = '–ú–∞–≥–∞–∑–∏–Ω';
  };

  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–æ–±—ã—á–∞
  setInterval(() => {
    if(autoMining > 0) {
      coal += autoMining;
      gainXP(1);
      updateUI();
      checkMissions();
    }
  }, 1000);

  // –ó–≤—É–∫ (–ø—Ä–æ—Å—Ç–∞—è –∑–∞–≥–ª—É—à–∫–∞)
  function playSound(type) {
    if(!soundOn) return;
    // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∞—É–¥–∏–æ –∑–¥–µ—Å—å, —Å–µ–π—á–∞—Å –ø—Ä–æ—Å—Ç–æ console
    console.log(`Sound: ${type}`);
  }

  btnSoundToggle.onclick = () => {
    soundOn = !soundOn;
    btnSoundToggle.textContent = soundOn ? 'üîà' : 'üîá';
  };

  btnMusicToggle.onclick = () => {
    musicOn = !musicOn;
    btnMusicToggle.textContent = musicOn ? 'üéµ' : 'üîï';
  };

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
  updateUI();

  // --- Canvas –∞–Ω–∏–º–∞—Ü–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä –º–µ—Ä—Ü–∞—é—â–∏–π —É–≥–æ–ª—å) ---
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');
  let sparkle = 0;

  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // –§–æ–Ω —à–∞—Ö—Ç—ã
    ctx.fillStyle = '#1e293b';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // –ù–∞—Ä–∏—Å—É–µ–º —É–≥–æ–ª—å (–º–µ—Ä—Ü–∞—é—â–∏–π)
    const coalX = canvas.width / 2 - 30;
    const coalY = canvas.height / 2 - 30;
    ctx.fillStyle = `rgba(17, 17, 17, ${0.8 + 0.2 * Math.sin(sparkle)})`;
    ctx.shadowColor = '#222';
    ctx.shadowBlur = 15;
    ctx.beginPath();
    ctx.moveTo(coalX + 8, coalY + 4);
    ctx.lineTo(coalX + 20, coalY + 5);
    ctx.lineTo(coalX + 24, coalY + 12);
    ctx.lineTo(coalX + 19, coalY + 22);
    ctx.lineTo(coalX + 8, coalY + 24);
    ctx.lineTo(coalX + 5, coalY + 15);
    ctx.closePath();
    ctx.fill();

    ctx.shadowBlur = 0;
    ctx.fillStyle = '#555';
    ctx.beginPath();
    ctx.moveTo(coalX + 10, coalY + 7);
    ctx.lineTo(coalX + 14, coalY + 8);
    ctx.lineTo(coalX + 13, coalY + 12);
    ctx.lineTo(coalX + 9, coalY + 11);
    ctx.closePath();
    ctx.fill();

    sparkle += 0.05;

    requestAnimationFrame(draw);
  }
  draw();
})();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Угольный Кликер 2.0</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap');
  body {
    margin: 0;
    background: #0a0a12;
    color: #e0e7ff;
    font-family: 'Montserrat', sans-serif;
    user-select: none;
    overflow: hidden;
  }
  #game-container {
    display: flex;
    flex-direction: row;
    height: 100vh;
    width: 100vw;
  }
  #left-panel {
    flex: 1;
    position: relative;
    background: radial-gradient(circle at center, #5a5f7f, #0a0a12);
  }
  #canvas {
    display: block;
    margin: auto;
    background: transparent;
    cursor: pointer;
    max-width: 100%;
    max-height: 100vh;
  }
  #right-panel {
    width: 350px;
    background: #121527cc;
    box-shadow: inset 0 0 15px #3957ff99;
    padding: 20px;
    box-sizing: border-box;
    overflow-y: auto;
  }
  h1 {
    margin-top: 0;
    font-weight: 700;
    font-size: 28px;
    text-align: center;
    color: #7db9ff;
  }
  .stat {
    font-size: 18px;
    margin: 8px 0;
    user-select: text;
  }
  button {
    width: 100%;
    padding: 12px;
    font-size: 16px;
    margin-top: 10px;
    border: none;
    border-radius: 8px;
    background: #3957ffcc;
    color: #e0e7ff;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.3s ease;
  }
  button:disabled {
    background: #26368088;
    cursor: not-allowed;
  }
  button:hover:not(:disabled) {
    background: #5a82ffcc;
  }
  .upgrade {
    background: #222a44cc;
    border-radius: 10px;
    margin-bottom: 15px;
    padding: 10px;
  }
  .upgrade-title {
    font-weight: 700;
    font-size: 18px;
    margin-bottom: 6px;
  }
  .upgrade-desc {
    font-size: 14px;
    margin-bottom: 8px;
  }
  .combo-text {
    position: absolute;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    font-weight: 700;
    font-size: 22px;
    color: #7db9ffcc;
    text-shadow: 0 0 8px #3957ffaa;
    user-select: none;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.3s ease;
  }
</style>
</head>
<body>

<div id="game-container">
  <div id="left-panel">
    <canvas id="canvas" width="600" height="400" title="Кликни по углю!"></canvas>
    <div id="combo-indicator" class="combo-text">Комбо!</div>
  </div>
  <div id="right-panel">
    <h1>Угольный Кликер 2.0</h1>
    <div class="stat">Уголь: <span id="coal-count">0</span></div>
    <div class="stat">Уголь за клик: <span id="coal-per-click">1</span></div>
    <div class="stat">Уголь в секунду: <span id="coal-per-second">0</span></div>
    <div class="stat">Комбо счетчик: <span id="combo-count">0</span></div>
    <hr />
    <div class="upgrade">
      <div class="upgrade-title">Кирка <span id="pickaxe-level">1</span></div>
      <div class="upgrade-desc">Увеличивает уголь за клик</div>
      <button id="buy-pickaxe">Купить кирку (+1 уголь) - Цена: <span id="pickaxe-price">50</span></button>
    </div>
    <div class="upgrade">
      <div class="upgrade-title">Рабочие шахты</div>
      <div class="upgrade-desc">Автоматически добывают уголь каждые 1 секунду</div>
      <button id="buy-miners">Нанять шахтеров (+1 уголь/сек) - Цена: <span id="miners-price">100</span></button>
    </div>
    <div class="upgrade">
      <div class="upgrade-title">Усилитель кликов</div>
      <div class="upgrade-desc">Увеличивает уголь за клик на 50% на 10 секунд</div>
      <button id="boost-clicks" disabled>Активировать усилитель (Цена: 200)</button>
      <div id="boost-timer" style="font-size:14px; margin-top:5px; color:#7db9ff;"></div>
    </div>
  </div>
</div>

<audio id="click-sound" src="https://freesound.org/data/previews/256/256113_3263906-lq.mp3" preload="auto"></audio>
<audio id="crit-sound" src="https://freesound.org/data/previews/146/146723_2398405-lq.mp3" preload="auto"></audio>

<script>
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');

  // Звуки
  const clickSound = document.getElementById('click-sound');
  const critSound = document.getElementById('crit-sound');
  clickSound.volume = 0.15;
  critSound.volume = 0.15;

  // Статистика
  let coal = 0;
  let coalPerClick = 1;
  let coalPerSecond = 0;
  let comboCount = 0;
  let comboActive = false;
  let comboTimer = null;

  // Кирка
  let pickaxeLevel = 1;
  let pickaxePrice = 50;

  // Шахтеры
  let minersCount = 0;
  let minersPrice = 100;

  // Усилитель кликов
  let boostActive = false;
  let boostDuration = 10000; // 10 секунд
  let boostEndTime = 0;
  let boostPrice = 200;

  // Критический клик
  const critChance = 0.15;
  const critMultiplier = 2;

  // Частицы клика
  let particles = [];

  // UI элементы
  const coalCountEl = document.getElementById('coal-count');
  const coalPerClickEl = document.getElementById('coal-per-click');
  const coalPerSecondEl = document.getElementById('coal-per-second');
  const comboCountEl = document.getElementById('combo-count');
  const pickaxeLevelEl = document.getElementById('pickaxe-level');
  const pickaxePriceEl = document.getElementById('pickaxe-price');
  const minersPriceEl = document.getElementById('miners-price');
  const boostClickBtn = document.getElementById('boost-clicks');
  const boostTimerEl = document.getElementById('boost-timer');
  const comboIndicator = document.getElementById('combo-indicator');

  // Всплывающий текст клика
  let clickTexts = [];

  // Настройки канваса и анимация
  function createParticle(x, y) {
    return {
      x,
      y,
      size: 8 + Math.random() * 6,
      alpha: 1,
      speedX: (Math.random() - 0.5) * 4,
      speedY: (Math.random() - 1.5) * 4,
      color: `rgba(125, 185, 255,`,
    };
  }

  function showClickText(x, y, text, isCrit = false) {
    clickTexts.push({ x, y, text, alpha: 1, yOffset: 0, isCrit });
  }

  // Обновление UI
  function updateUI() {
    coalCountEl.textContent = Math.floor(coal);
    coalPerClickEl.textContent = coalPerClick.toFixed(1);
    coalPerSecondEl.textContent = coalPerSecond.toFixed(1);
    comboCountEl.textContent = comboCount;
    pickaxeLevelEl.textContent = pickaxeLevel;
    pickaxePriceEl.textContent = pickaxePrice;
    minersPriceEl.textContent = minersPrice;
    boostClickBtn.disabled = coal < boostPrice || boostActive;
  }

  // Покупка кирки
  document.getElementById('buy-pickaxe').onclick = () => {
    if (coal >= pickaxePrice) {
      coal -= pickaxePrice;
      pickaxeLevel++;
      coalPerClick += 1;
      pickaxePrice = Math.floor(pickaxePrice * 1.7);
      updateUI();
    }
  };

  // Покупка шахтеров
  document.getElementById('buy-miners').onclick = () => {
    if (coal >= minersPrice) {
      coal -= minersPrice;
      minersCount++;
      coalPerSecond += 1;
      minersPrice = Math.floor(minersPrice * 1.5);
      updateUI();
    }
  };

  // Активировать усилитель кликов
  boostClickBtn.onclick = () => {
    if (coal >= boostPrice && !boostActive) {
      coal -= boostPrice;
      boostActive = true;
      boostEndTime = Date.now() + boostDuration;
      coalPerClick *= 1.5;
      boostClickBtn.disabled = true;
      updateUI();
    }
  };

  // Обработка комбо-системы и кликов по канвасу
  canvas.onclick = (e) => {
    let rect = canvas.getBoundingClientRect();
    let clickX = e.clientX - rect.left;
    let clickY = e.clientY - rect.top;

    let isCrit = Math.random() < critChance;
    let gain = coalPerClick * (isCrit ? critMultiplier : 1);

    // Комбо бонус если активен (5 сек после клика)
    if (comboActive) {
      gain *= 1.5;
    }

    coal += gain;

    // Комбо логика
    comboCount++;
    comboActive = true;
    comboIndicator.style.opacity = '1';
    clearTimeout(comboTimer);
    comboTimer = setTimeout(() => {
      comboCount = 0;
      comboActive = false;
      comboIndicator.style.opacity = '0';
      updateUI();
    }, 5000);

    // Частицы
    for (let i = 0; i < 15; i++) {
      particles.push(createParticle(clickX, clickY));
    }

    // Всплывающий текст
    showClickText(clickX, clickY, (isCrit ? `CRIT! +${Math.floor(gain)}` : `+${Math.floor(gain)}`), isCrit);

    // Звуки
    if (isCrit) {
      critSound.currentTime = 0;
      critSound.play();
    } else {
      clickSound.playbackRate = 0.9 + Math.random() * 0.2;
      clickSound.currentTime = 0;
      clickSound.play();
    }

    updateUI();
  };

  // Автодобыча угля шахтерами
  setInterval(() => {
    coal += coalPerSecond;
    updateUI();
  }, 1000);

  // Таймер усилителя кликов
  function updateBoost() {
    if (boostActive) {
      let remaining = boostEndTime - Date.now();
      if (remaining <= 0) {
        boostActive = false;
        coalPerClick /= 1.5;
        boostTimerEl.textContent = '';
        updateUI();
      } else {
        boostTimerEl.textContent = `Осталось: ${(remaining / 1000).toFixed(1)} сек`;
      }
    }
    requestAnimationFrame(updateBoost);
  }
  updateBoost();

  // Отрисовка
  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Фон с градиентом
    let gradient = ctx.createRadialGradient(canvas.width / 2, canvas.height / 2, 50, canvas.width / 2, canvas.height / 2, 300);
    gradient.addColorStop(0, '#5a5f7f');
    gradient.addColorStop(1, '#0a0a12');
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Центральный уголь с свечением
    ctx.fillStyle = '#3a3affcc';
    ctx.shadowColor = '#7db9ffcc';
    ctx.shadowBlur = 14;
    ctx.fillRect(250, 120, 100, 80);
    ctx.shadowBlur = 0;

    // Эмодзи угля
    ctx.fillStyle = '#e0e7ff';
    ctx.font = '72px Montserrat';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText('🪨', canvas.width / 2, canvas.height / 2);

    // Частицы
    for (let i = particles.length - 1; i >= 0; i--) {
      let p = particles[i];
      ctx.fillStyle = p.color + p.alpha + ')';
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
      ctx.fill();

      p.x += p.speedX;
      p.y += p.speedY;
      p.alpha -= 0.03;
      p.size *= 0.96;

      if (p.alpha <= 0) particles.splice(i, 1);
    }

    // Всплывающий текст клика
    ctx.font = '20px Montserrat';
    ctx.textAlign = 'center';
    for (let i = clickTexts.length - 1; i >= 0; i--) {
      let t = clickTexts[i];
      ctx.fillStyle = t.isCrit ? `rgba(255, 165, 0, ${t.alpha})` : `rgba(125, 185, 255, ${t.alpha})`;
      ctx.fillText(t.text, t.x, t.y - t.yOffset);
      t.alpha -= 0.02;
      t.yOffset += 0.7;
      if (t.alpha <= 0) clickTexts.splice(i, 1);
    }

    requestAnimationFrame(draw);
  }
  draw();

  // Начальное обновление UI
  updateUI();
</script>

</body>
</html>
